# sinatra-docdsl

DSL for documenting Sinatra applications and exposing the resulting documentation via /doc on the resource.

We needed a tool to document our Sinatra based REST API at Localstream and I decided to write my own tool.

Sinatra-docdsl integrates nicely with the Sinatra framework and extends the Sinatra DSL with a few documentation specific constructs. The current version simply produces a simple html page but it should be pretty easy to modify the rendering to produce more complex output or e.g. a WADL description file.

# install

Sinatra-docdsl is available at rubygems https://rubygems.org/gems/sinatra-docdsl. So, you can simply install it like this:

    gem install sinatra-docdsl

# Usage

Here's a sample application that shows of how you use docdsl. You can find it in the example directory. 


Notice that we there is a render function in the page declaration. It simply delegates to the builtin html renderer that outputs a simple documentation page (this is the default). There is also a json implementation that you may use and it is very easy to plug in your own implementation.

    > config.ru
    require 'sinatra'
    require 'json'
    require 'docdsl'

    # simple sinatra app to demo how you use DocDSL
    class DocumentedApp < Sinatra::Base
      register Sinatra::DocDsl 
  
  
      page do      
        title "DocDSL demo"
        header "DocDSL is a tool to document REST APIs implemented using Sinatra"
        introduction "It is awesome"
        footer "This page was generated by sinatra-docdsl"
        configure_renderer do
          self.html
        end
      end
  
      documentation "redirect to the documentation" do
        response "redirects"
        status 303,"see other"
      end
      get "/" do
        redirect "/doc"
      end

      documentation "get a list of things"
      get "/things" do
        [200,"[1,2,3]"]
      end
  
      documentation "post a blob" do
        payload "some json content"
        response "some other json content"
      end

      post "/things" do
        [200,"[42]"]
      end

      documentation "you can document" do
        param :param1, "url parameters"
        query_param :queryParam1, "query string parameters"
        header 'Content-Type', "header"
        header 'Etag', "another header"
        payload "the payload", {:gimme=>"danger"}
        response "and of course a the response", {:some_field=>'sample value'}
        status 200,"okidokie"
        status 400,"that was bad"
      end
      post "/everything/:param1" do | param1 |    
        [200,{:theThing=>param1}.to_json]
      end
    end

    map '/' do
      run DocumentedApp
    end

# License

This code is licensed under the expat license. See the LICENSE file for details.

# Changes

- 0.4 refactor to enable custom rendering and add ability to document status codes and add sample requests and responses ruby objects that are pretty printed as json
- 0.1-0.3 First few releases. 

        
# Acknowledgements

Inspired by and based on https://github.com/softprops/sinatra-doc. I've pretty much rewritten a lot of the code and tests but the original idea comes from softprops.

